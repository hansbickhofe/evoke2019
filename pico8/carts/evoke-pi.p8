pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
data={0,0,0,0,0,0,0,0}
last={1,1,1,1,1,1,1,1}
cnt={0,20,40,60,80}
spd=1
id=1
rid=1
r={2,4,8,16,32,64}
chr={"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","1","2","3","4","5","6","7","8","9","0"}

tracks={
 "electric beams",
 "neon rider",
 "grid runner",
 "ascii glitch",
 "light leak",
 "vhs age",
 "matrix",
 "laser bars"
}

function _init()
 matrixdata()
end

function _update()
 mqttdata()
 if (btnp(0) and id > 1) id -= 1
 if (btnp(1) and id < 8) id += 1
 
 if (btnp(3) and rid > 1) rid -= 1 
 if (btnp(2) and rid < 6) rid += 1
	
	l100()
end


function l100()
	for i=1,5 do
	 cnt[i]+=spd
		if cnt[i]>100 then cnt[i]=0 end
	end
end

function matrixdata()
 //sorted list
	col={}
	chn={}
	for j=1,32 do 
	 add(col,j)
	 add(chn,flr(rnd(5))+1)
	end

	//shuffled list
	shf={}
	
	for j=1,32 do
	 val=col[flr(rnd(32))+1]
	 add(shf,val)
	 del(col,val)
	end
	
end

function _draw()
 cls(0)
	
	if(id==1) tunnel (1,12)
	if(id==2) grid1 (1,12)
	if(id==3) grid2 (1,12)
	if(id==4) tesla (1,12)
	if(id==5) c64 (r[rid])
	if(id==6) noize (r[rid])
	if(id==7) matrix (3,11)
 if(id==8) laser (3,11)
 
 //sun(16)
 //rocket()
	//flamingo()
	pyramid()
	
	hud()
end
-->8
//box tunnel
function tunnel(c1,c2)
 line(0,0,127,127,c1)
 line(127,0,0,127,c1)
 for i=1,5 do
  rect(63-cnt[i],63-cnt[i],63+cnt[i],63+cnt[i],c2)
 end
end

//perspective grid
function grid1(c1,c2)
 line(63,63,0,70,c2)
 line(63,63,0,79,c2)
 line(63,63,0,105,c2)
 line(63,63,31,127,c2)
 line(63,63,96,127,c2)
 line(63,63,127,105,c2)
 line(63,63,127,79,c2)
 line(63,63,127,70,c2)
 line(0,63,127,63,c2)
	
 for i=1,5 do
  line(0,63+cnt[i],127,63+cnt[i],c2)
 end
end

//checkerboard grid
function grid2(c1,c2)
 for i=1,10 do
  line(0,i*12-3,127,i*12-3,c1)
  line(i*12-3,0,i*12-3,127,c1)
  posx=-2+flr(rnd(11))*12
  posy=-2+flr(rnd(11))*12
  rectfill(posx,posy,posx+10,posy+10,c2)
 end
end

//tesla coil
function tesla(c1,c2)
	local c={8,9,10,11}
	local y1={0,0,0,0,0,0,0,0,0,0}
	local y2={0,0,0,0,0,0,0,0,0,0}
 local ly=0
 
 for i=1,4 do
  color(c[i])
  
  for j=1,10 do
   x1=(j-1)*12.7
   x2=j*12.7
   
   y1[j]=ly
   y2[j]=-10+rnd(20)
   ly=y2[j]
  
   if j==1 then y1[j]=0 end
   if j==10 then y2[j]=0 end
   
	 	line(x1,i*25+y1[j],x2,i*25+y2[j])		
	 end
	end
end

//c64 loaderd
function c64(rez)
 size=128/rez
 for i=1,rez do
  rectfill(0,(i-1)*size,127,i*size,flr(rnd(16)))
 end
end

//noize
function noize(rez)
 size=128/rez
 for i=1,rez do
  for j=1,rez do
   rectfill((j-1)*size,(i-1)*size,j*size,i*size,flr(rnd(16)))
  end
 end
end

//matrix
function matrix(c1,c2)
	local r
	
	//bg fill
	for i=1,22 do
	 for j=1,32 do
	  r=flr(rnd(count(chr)))
	  char=chr[r+1]
	  print(char,(j-1)*5,(i-1)*6,1)
	 end
	end
	
	for j=1,32 do
		//rnd x pos
  //print(shf[j],(j-1)*10,0,7)
  for i=1,22 do
  	r=flr(rnd(count(chr)))
   char=chr[r+1]
   if i<22 then print(char,(j-1)*5,(i-1)*6+cnt[chn[j]]*2.56-150,c1)
   else print(char,(j-1)*5,(i-1)*6+cnt[chn[j]]*2.56-150,c2)
   end
  end
 end
end

//laser
function laser() 
 local c={10,9,12,11,14}
 for i=1,5 do
  local ypos=36+(i-1)*10
  rectfill(0,ypos,cnt[chn[i]]*1.28,ypos+8,c[i])
 end
end

function hud()
 //id
 rectfill(127-15,0,127,15,7)
 print("0"..id,127-7,10,0)
 
 //track
 rectfill(0,127-15,63,127,8)
 print("track:0"..id,3,127-13,7)
 print(tracks[id],3,127-6,15)
end
-->8
function sun(y)
 spr(0,63-16,63-y,4,4)
end

//rocket
function rocket()
 local c={10,9,14}
 local group={3,1,2} 
 for j=1,3 do
 	for i=1,3 do
	  local xpos=group[j]*32+(i-1) 
	  rectfill(xpos,128,xpos,128-cnt[j]*1.6,c[i])//flr(rnd(16))) //c[i]
	 end
  spr(4,group[j]*32-9,128-(cnt[j]*1.6),2,2)
 end
end

//flamingo
function flamingo()
 if rnd(1)>.5 then spr(6,63-8,63-16,3,4) end
end

//pyramid
function pyramid()
 if rnd(1)>.5 then spr(9,63-18,63-16,5,4) end
end

-->8
function mqttdata()
 for i=0,7 do
  data[i+1] = peek(0x5f80 + i)
 end

 if (last[1] != data[1] and id > 1 ) then 
  id -= 1
  last[1] = data[1]
 end 
 
 if (last[1] != data[1] and id < 7 ) then 
   id += 1
   last[1] = data[1]
 end
end
__gfx__
000000000000aaaaaaaa000000000000000000000777000000eeeee0000000000000000000000000000000000c00000000000000000000000000000000000000
000000000aaaaaaaaaaaaaa00000000000000000777700000e77777e00000000000000000000000000000000c7c0000000000000000000000000000000000000
0000000aaaaaaaaaaaaaaaaaa00000000000000077770000e7eee7e7e000000000000000000000000000000c7c7c000000000000000000000000000000000000
000000aaaaaaaaaaaaaaaaaaaa0000000000000677770000e7ee77ee7e00000000000000000000000000000c7c7c000000000000000000000000000000000000
00000aaaaaaaaaaaaaaaaaaaaaa0000000000006777700000e777e0e7e0000000000000000000000000000c77cc7c00000000000000000000000000000000000
0000aaaaaaaaaaaaaaaaaaaaaaaa0000000000067777000000eee0e77e000000000000000000000000000c7c7c0c7c0000000000000000000000000000000000
000aaaaaaaaaaaaaaaaaaaaaaaaaa000000000067777000000000e77e0000000000000000000000000000c7c7c0c7c0000000000000000000000000000000000
00aaaaaaaaaaaaaaaaaaaaaaaaaaaa0000000006777700000000e77e0000000000000000000000000000c7c7c000c7c000000000000000000000000000000000
00aaaaaaaaaaaaaaaaaaaaaaaaaaaa0000000006777700000000e7e0000000000000000000000000000c7cc7c0000c7c00000000000000000000000000000000
0000000000000000000000000000000000000006777760000000e7e00000eee00000000000000000000c7cc7c0000c7c00000000000000000000000000000000
0aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa000000067777760000000e7e00eee777e000000000000000000c7cc7c000000c7c0000000000000000000000000000000
0aaaaaaaaaaaaaaaaaaaaaaaaaaaaaa00000006777776600000e7e7ee777eee7e0000000000000000c7c0c7c0000000c7c000000000000000000000000000000
00000000000000000000000000000000000006777777666000e7eee77eee000e7e000000000000000c7c0c7c0000000c7c000000000000000000000000000000
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa000067777777666000e7e00ee0000000e7e0000000000000c7c0c7c000000000c7c00000000000000000000000000000
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa000677777777600000e7e000000000000e7e00000000000c7c00c7c0000000000c7c0000000000000000000000000000
00000000000000000000000000000000000677777000000000e7e000000000000e7e00000000000c7c00c7c0000000000c7c0000000000000000000000000000
99999999999999999999999999999999000000000000000000e7e000000000ee0e7e0000000000c7c00c7c000000000000c7c000000000000000000000000000
999999999999999999999999999999990000000000000000000e7e0000000e77ee7e000000000c7c000c7c0000000000000c7c00000000000000000000000000
0000000000000000000000000000000000000000000000000000e7e00000e7ee7e7e000000000c7c000c7c0000000000000c7c00000000000000000000000000
99999999999999999999999999999999000000000000000000000e7ee00e7e00e77e00000000c7c000c7c000000000000000c7c0000000000000000000000000
099999999999999999999999999999900000000000000000000000e77ee7e0000e7e0000000c7c0000c7c0000000000000000c7c000000000000000000000000
00000000000000000000000000000000000000000000000000000000e7ee7e0000e00000000c7c0000c7c0000000000000000c7c000000000000000000000000
08888888888888888888888888888880000000000000000000000000e7ee7e000000000000c7c0000c7c000000000000000000c7c00000000000000000000000
00888888888888888888888888888800000000000000000000000000e7ee7e00000000000c7c00000c7c0000000000000000000c7c0000000000000000000000
00000000000000000000000000000000000000000000000000000000e7e7e000000000000c7c00000c7c0000000000000000000c7c0000000000000000000000
00088888888888888888888888888000000000000000000000000000e77e0000000000000c7c0000c7c000000000000000000cccc7c000000000000000000000
0000888888888888888888888888000000000000000000000000000e77e000000000000000c7c000c7c0000000000000ccccc77777c000000000000000000000
0000000000000000000000000000000000000000000000000000000e77e0000000000000000c7c00c7c00000000ccccc77777ccccc0000000000000000000000
000000222222222222222222220000000000000000000000000000e7e7e00000000000000000c7c07c0000ccccc77777ccccc000000000000000000000000000
000000022222222222222222200000000000000000000000000000e7e7e000000000000000000c7c7ccccc77777ccccc00000000000000000000000000000000
000000000000000000000000000000000000000000000000000000e7e7e0000000000000000000c7777777ccccc0000000000000000000000000000000000000
000000000000222222220000000000000000000000000000000000e7e7e00000000000000000000ccccccc000000000000000000000000000000000000000000
